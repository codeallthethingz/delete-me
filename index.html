<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Spreadsheet Table</title>
  <link href="tabulator.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" crossorigin="anonymous"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }

    /* .tabulator {
      display: inline-block;
    } */

    .badge {
      background-color: #aaaaff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .badge-size-small {
      background-color: #b6fcb6;
      color: #222;
    }

    .badge-size-medium {
      background-color: #4ec04e;
      color: #fff;
    }

    .badge-size-large {
      background-color: #006400;
      color: #fff;
    }

    .badge-size-unknown {
      background-color: #cccccc;
      color: #222;
    }
  </style>
</head>

<body>
  <div id="table"></div>

  <script type="text/javascript" src="tabulator.min.js"></script>
  <script>
                        function formatImplementationColumn(cell, formatterParams, onRendered) {
                          const usernames = (cell.getValue() || "").split(",").map(u => u.trim()).filter(Boolean);
                          return usernames.map(username =>
                            `<img src="https://github.com/${encodeURIComponent(username)}.png" width="24" height="24" style="vertical-align:middle;border-radius:2px;" alt="${username}"/>`
                          ).join(" ");
                        }

                        function formatTagsColumn(cell, formatterParams, onRendered) {
                          const tags = (cell.getValue() || "").split(",").map(t => t.trim()).filter(Boolean);
                          return tags.map(tag =>
                            `<span class="badge">${tag}</span>`
                          ).join(" ");
                        }

                        function formatSizeColumn(cell, formatterParams, onRendered) {
                          const value = (cell.getValue() || "").trim().toLowerCase();
                          const label = value || "unknown";
                          const badgeClass = `badge-size-${label}`;
                          return `<span class="badge ${badgeClass}">${label}</span>`;
                        }

                        function formatLinkColumn(cell, formatterParams, onRendered) {
                          const value = cell.getValue();
                          if (!value) return "";
                          const fullUrl = `https://thousandbrainsproject.readme.io/docs/${value}`;
                          return `<a href="${fullUrl}" target="_blank" rel="noopener noreferrer" title="${fullUrl}">
        <i class="fas fa-external-link-alt"></i>
      </a>`;
                        }

                        let offline = true;
                        let url = '/api/data';

    if (offline) {
      url = 'data.json';
    }

  fetch(url)
    .then(res => res.json())
    .then(data => {
      new Tabulator("#table", {
        data: data,
        autoColumns: true,
        layout: 'fitDataStretch',
        autoColumnsDefinitions: {
          implementation: {
            formatter: formatImplementationColumn,
          },
          tags: {
            formatter: formatTagsColumn,
          },
          size: {
            formatter: formatSizeColumn,
          },
          link: {
            formatter: formatLinkColumn,
          },
          group: {
            visible: false,
          }
        },
        groupBy: "group"
      });
    })
    .catch(err => console.error(err));
  </script>
</body>

</html>